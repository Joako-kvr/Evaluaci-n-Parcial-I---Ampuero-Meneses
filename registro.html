<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciar Sesión</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
     <link rel="stylesheet" href="assets/styles/style.css">
</head>

<body>

<header>
  <nav class="navbar navbar-expand-lg bg-body-tertiary">
    <div class="container">
      <a class="navbar-brand fw-bold" href="home.html">Pastelería Mil Sabores</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div id="nav" class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a href="home.html" class="nav-link">Inicio</a></li>
          <li class="nav-item"><a href="productos.html" class="nav-link">Productos</a></li>
          <li class="nav-item"><a href="nosotros.html" class="nav-link">Nosotros</a></li>
          <li class="nav-item"><a href="contacto.html" class="nav-link ">Contacto</a></li>
          <li class="nav-item"><a href="blog.html" class="nav-link">Blog</a></li>
          <li class="nav-item"><a href="productos.html" class="nav-link">Carrito</a></li>
          <li class="nav-item"><a href="iniciar sesion.html" class="nav-link">Iniciar sesión</a></li>
          <li class="nav-item"><a href="registro.html" class="nav-link active">Registro</a></li>
          </li>
          </li>
        </ul>
      </div>
    </div>
  </nav>



</header>


<main>
    <section class="container" style="width: 500px"> 
            <div class="row">
                <div class="col-xl-12 mt-3 border p-3 rounder-3 ">
                    <h1 class="text-center">Registro</h1>
                    <div class="mb-3" >
                        <label for="nombre" class="form-label">Nombre</label>
                        <input type="text" class="form-control" id="nombre" aria-describedby="nombreHelp" >
                        <div id="nombreHelp" class="form-text" style="color:red; display: none">*Nombre no válido</div>
                        <div id="errorNombreVacio" class="form-text" style="color:red; display: none">*Obligatorio</div>
                      </div>
                    <div class="mb-3" >
                        <label for="apellido" class="form-label">Apellido</label>
                        <input type="text" class="form-control" id="apellido" aria-describedby="apellidoHelp" >
                        <div id="apellidoHelp" class="form-text" style="color:red; display: none">*Apellido no válido</div>
                        <div id="errorApellidoVacio" class="form-text" style="color:red; display: none">*Obligatorio</div>
                      </div>
                    <div class="mb-3" >
                        <label for="correo" class="form-label">Correo</label>
                        <input type="email" class="form-control" id="correo" aria-describedby="correoHelp" >
                        <div id="correoHelp" class="form-text" style="color:red; display: none">*Correo no válido</div>
                        <div id="errorCorreoVacio" class="form-text" style="color:red; display: none">*Obligatorio</div>
                      </div>
                    <div class="mb-3" >
                        <label for="fechaNacimiento" class="form-label">Fecha Nacimiento</label>
                        <input type="date" class="form-control" id="fechaNacimiento" aria-describedby="fechaNacimientoHelp">
                        <div id="fechaNacimientoHelp" class="form-text" style="color:red; display: none">*Fecha no válida</div>
                        <div id="errorFechaNacimientoVacio" class="form-text" style="color:red; display: none">*Seleccione fecha</div>
                      </div>
                    <div class="mb-3" >
                        <label for="password" class="form-label">Contraseña</label>
                        <input type="password" class="form-control" id="password" aria-describedby="passwordHelp" >
                        <div id="passwordHelp" class="form-text" style="color:red; display: none">*Debe tener al menos una mayúscula, una minúscula, un número y mínimo 8 caracteres</div>
                        <div id="errorPasswordVacio" class="form-text" style="color:red; display: none">*Obligatorio</div>
                      </div>

                    <div class="mb-3" >
                        <label for="passwordRep" class="form-label">Repita Contraseña</label>
                        <input type="password" class="form-control" id="passwordRep" aria-describedby="emailHelp" >
                        <div id="passwordRepHelp" class="form-text" style="color:red; display: none">*Contraseña no coincide</div>
                        <div id="errorPasswordRepVacio" class="form-text" style="color:red; display: none">*Obligatorio</div>
                      </div>


                    <div class="mb-3" >
                        <label for="codigo" class="form-label">Código Descuento</label>
                        <input type="text" class="form-control" id="codigo" aria-describedby="codigoHelp" >
                        <div id="codigoHelp" class="form-text" style="color:red; display: none">*Código no válido</div>
                        <div id="codigoAceptado" class="form-text" style="color:green; display: none">*Código Válido!</div>
                      </div>

                      <div class="mb-3">
                            <button class="btn btn-primary" onclick="procesarRegistro()">Registro </button>
                            <button class="btn btn-secondary" onclick="limpiarFormulario()">Limpiar</button>

                      </div>
                </div>

            </div>
        <div id="modalMensaje" style="display: none;
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); align-items: center; justify-content: center; z-index: 9999;">
          <div style="background: white; padding: 20px; border-radius: 8px; text-align: center; max-width: 400px;">
            <h3 style="margin-bottom: 20px;">Usuario Creado</h3 >
            <p id="contenidoModal"></p>
            <button onclick="irAHome()">Regresar a la página principal</button>
          </div>
        </div>


        </section>



</main>
  <footer>
    <div class="container">
      <p class="mb-0">© 2025 Pastelería Mil Sabores. Todos los derechos reservados.</p>
    </div>
  </footer>


    <script>

      var esAdulto = false;
      var esMayor50 = false;
      var esCumpleaños = false;
      var registroCorrecto= 0;
      var codigoAceptado = false;

      function validarNombre() {
        var regexNombre = /^[a-zA-ZñÑáéíóú]+$/;
        var txtNombre = document.getElementById("nombre").value;

        if (txtNombre == ''){
        document.getElementById("errorNombreVacio").style.display = 'block';
        document.getElementById("nombreHelp").style.display = 'none';
        return;    
        }else {
            document.getElementById("errorNombreVacio").style.display = 'none';        
        }

        if (regexNombre.test(txtNombre)){
        console.log("El nombre es válido");
        document.getElementById("nombreHelp").style.display = 'none';
        registroCorrecto++;
        }else {
        console.log("El nombre no es válido");
        document.getElementById("nombreHelp").style.display = 'block';
        return;
        }
      }

      function validarApellido() {
        var regexApellido = /^[a-zA-ZñÑáéíóú]+$/;
        var txtApellido = document.getElementById("apellido").value;

        if (txtApellido == ''){
        document.getElementById("errorApellidoVacio").style.display = 'block';
        document.getElementById("apellidoHelp").style.display = 'none';
        return;    
        }else {
            document.getElementById("errorApellidoVacio").style.display = 'none';        
        }

        if (regexApellido.test(txtApellido)){
        console.log("El apellido es válido");
        document.getElementById("apellidoHelp").style.display = 'none';
        registroCorrecto++;
        }else {
        console.log("El apellido no es válido");
        document.getElementById("apellidoHelp").style.display = 'block';
        return;
        }
      }


      function validarCorreo() {
        var regexCorreo = /^[a-zA-Z0-9._\-]+@(duoc\.cl|gmail\.com|yahoo\.es|outlook\.com|hotmail\.com|duoc\.com)$/;
        var txtCorreo = document.getElementById("correo").value.toLowerCase();

        if (txtCorreo == ''){
        document.getElementById("errorCorreoVacio").style.display = 'block';
        document.getElementById("correoHelp").style.display = 'none';
        return;    
        }else {
            document.getElementById("errorCorreoVacio").style.display = 'none';        
        }

        if (regexCorreo.test(txtCorreo)){
        console.log("El correo es válido");
        document.getElementById("correoHelp").style.display = 'none';
        registroCorrecto++;
        }else {
        console.log("El correo no es válido");
        document.getElementById("correoHelp").style.display = 'block';
        return;
        }
      }

      function validarEdad() {
        var fechaNacimiento = document.getElementById("fechaNacimiento").value;
        var hoy = new Date();
        if (!fechaNacimiento) {
          document.getElementById("errorFechaNacimientoVacio").style.display = 'block';
          return;
        }else{
          document.getElementById("errorFechaNacimientoVacio").style.display = 'none';
        };
        var fechaNacimiento = new Date (document.getElementById("fechaNacimiento").value);
        var edad = hoy.getFullYear() - fechaNacimiento.getFullYear();
        var mesActual = hoy.getMonth();
        var diaActual = hoy.getDate();

        var yaCumplioEsteAño = (
          mesActual > fechaNacimiento.getMonth() ||
          (mesActual == fechaNacimiento.getMonth() && diaActual >= fechaNacimiento.getDate())
        );

        if (!yaCumplioEsteAño) {
          edad--;
        }

        esCumpleaños = (
          fechaNacimiento.getDate() == diaActual &&
          fechaNacimiento.getMonth() == mesActual
        );

        esAdulto = edad >= 18;

        esMayor50 = edad > 50;


        if (edad > 100 || edad < 14 ){
           document.getElementById("fechaNacimientoHelp").style.display = 'block';
           
        }else{
          document.getElementById("fechaNacimientoHelp").style.display = 'none';
          registroCorrecto++;
          
        }

    }


      function validarPassword() {
        var regexSoloLetrasYNumeros = /^[a-zA-Z0-9]+$/; 
        var txtPassword = document.getElementById("password").value;
        var tieneMayuscula = /[A-Z]/.test(txtPassword);
        var longitudMinima = txtPassword.length >= 8;

        if (txtPassword == ''){
        document.getElementById("errorPasswordVacio").style.display = 'block';
        document.getElementById("passwordHelp").style.display = 'none';
        return;    
        }else {
            document.getElementById("errorPasswordVacio").style.display = 'none';        
        }

        if (!regexSoloLetrasYNumeros.test(txtPassword) || !tieneMayuscula || !longitudMinima){
        console.log("El password no es válido");
        document.getElementById("passwordHelp").style.display = 'block';
        }else {
        console.log("El password es válido");
        document.getElementById("passwordHelp").style.display = 'none';
        registroCorrecto++;
        }
      }

      function validarPasswordRep() {
        var txtPassword = document.getElementById("password").value;
        var txtPasswordRep = document.getElementById("passwordRep").value;

        if (txtPasswordRep == ''){
        document.getElementById("errorPasswordRepVacio").style.display = 'block';
        document.getElementById("passwordRepHelp").style.display = 'none';
        return;    
        }else {
            document.getElementById("errorPasswordRepVacio").style.display = 'none';        
        }

        if (txtPassword != txtPasswordRep){
        console.log("Contraseña no coincide");
        document.getElementById("passwordRepHelp").style.display = 'block';
        }else {
        console.log("Contraseña coincide");
        document.getElementById("passwordRepHelp").style.display = 'none';
        registroCorrecto++;
        return;
        }
      }
                
      function irAHome() {
          window.location.href = "home.html";
        }

      function mensajesValidaciones() {
        var mensajes = [];
        var correo = document.getElementById("correo").value.toLowerCase();

        document.getElementById("modalMensaje").style.display = 'flex';

        if (esMayor50) {
          mensajes.push("¿Tienes más de 50 años? ¡Nosotros también!. ¡Todos nuestros Productos a mitad de precio!");
        }

        if (correo.endsWith("@duoc.cl") || correo.endsWith("@duoc.com") ) {
          mensajes.push("Por que no todo es estudiar, ¡Tienes una torta gratis el dia de tu cumpleaños por ser estudiante de Duoc!");
        }

        if (codigoAceptado == true) {
          mensajes.push("Tienes un descuento del 10% de por vida con el siguiente código: FELICES50");
        }

        document.getElementById("contenidoModal").textContent = mensajes.join(" ");
        
      }



      function procesarRegistro() {
        registroCorrecto= 0;
        validarNombre();
        validarApellido();
        validarCorreo();
        validarPassword();
        validarPasswordRep();
        validarEdad();
      
      if (registroCorrecto == 6){
          mensajesValidaciones(); 
          localStorage.setItem("nombreUsuario", "Guillermo"); 
          }
    }

      function limpiarFormulario() {
        document.getElementById("nombre").value = "";
        document.getElementById("apellido").value = "";
        document.getElementById("correo").value = "";
        document.getElementById("fechaNacimiento").value = "";
        document.getElementById("password").value = "";
        document.getElementById("passwordRep").value = "";
        document.getElementById("codigo").value = "";
      }


      // Segmento validador de códigos
      var codigosValidos = ["FELICES50"]; 

      document.getElementById("codigo").addEventListener("input", validarCodigo);

      function validarCodigo() {
        var input = document.getElementById("codigo").value.trim(); 
        var valido = codigosValidos.includes(input); 

        if (input === "") {
          document.getElementById("codigoHelp").style.display = "none";
          document.getElementById("codigoAceptado").style.display = "none";
          return;
        }

        if (valido) {
          document.getElementById("codigoAceptado").style.display = "block";
          document.getElementById("codigoHelp").style.display = "none";
          codigoAceptado = true;
        } else {
          document.getElementById("codigoHelp").style.display = "block";
          document.getElementById("codigoAceptado").style.display = "none";
        }
      }







    </script>

<script>
  // Scripto culta el inicio de sesion y el registro si un usuario esta activo en la pagina
  document.addEventListener("DOMContentLoaded", function () {
    const nombreUsuario = localStorage.getItem("nombreUsuario");

    if (nombreUsuario) {
      const nombreEl = document.getElementById("nombreUsuarioHeader");
      nombreEl.textContent = "¡Bienvenido " + nombreUsuario + "!";
      nombreEl.style.color = "pink";

      document.getElementById("usuarioActivo").style.display = "flex";
      document.getElementById("cerrarSesionBtn").style.display = "flex"

      document.querySelectorAll('.nav-link[href="registro.html"], .nav-link[href="iniciar sesion.html"]').forEach(el => {
        el.parentElement.style.display = 'none';
      });


      document.getElementById("cerrarSesionBtn").addEventListener("click", function () {
        localStorage.removeItem("nombreUsuario");
        location.reload(); 
        document.getElementById("cerrarSesionBtn").style.display = 'none'; 
      });
    }
  });
</script>




    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous">
    </script>
</body>
</html>